# PetLog 寵物醫院地圖功能 PRD

## 背景與目標

PetLog 作為寵物健康紀錄平台，需要提供「寵物醫院地圖」功能，幫助飼主快速找到合格獸醫院。此功能的核心是讓使用者方便搜尋、定位、查看獸醫院資訊，並避免使用 Google Maps API 時超額。

## 現有資源

- 已擁有 2,058 筆台灣獸醫院資料（output/hospitals.json）
- 資料包含：縣市、機構名稱、地址、電話、負責獸醫、執照狀態等
- 缺少：GPS 座標、營業時間、Google 評分等資訊

## 使用者需求

1. **地圖瀏覽**：在地圖上查看附近獸醫院，點擊標記可顯示基本資訊
2. **列表檢視**：以清單方式呈現搜尋結果，支援排序與篩選
3. **關鍵字搜尋**：可依照名稱、地址、負責獸醫進行搜尋
4. **醫院詳情**：顯示完整資訊（名稱、地址、電話、執照資訊、狀態）
5. **導航整合**：可點擊連結開啟 Google Maps 導航

## 技術架構

### 後端（Go + Clean Architecture）

1. **Domain 層**：
   - Hospital 領域模型
   - HospitalRepository 介面定義

2. **Usecase 層**：
   - SearchHospitals：關鍵字/地理範圍搜尋
   - GetHospitalDetail：取得詳細資訊
   - ListHospitalsByArea：區域醫院列表

3. **Infrastructure 層**：
   - MongoDB 資料庫實作
   - 地址轉座標服務（Geocoding）
   - 資料匯入腳本

4. **API Endpoints**：
   - GET /api/hospitals（搜尋/列表）
   - GET /api/hospitals/{id}（詳情）
   - GET /api/hospitals/nearby（附近醫院）

### 前端（Next.js + React）

1. **地圖整合**：
   - 使用 Leaflet + OpenStreetMap（避免 Google Maps 成本）
   - 響應式地圖介面

2. **頁面結構**：
   - /hospitals：主頁面（地圖+列表切換）
   - /hospitals/[id]：詳情頁

3. **核心元件**：
   - HospitalMap：地圖顯示
   - HospitalList：列表檢視
   - HospitalSearch：搜尋功能
   - HospitalCard：資訊卡片

## 成本控制（保險絲機制）

為避免外部 API 成本超標，系統需具備保險絲機制：

1. **正常模式**：完整功能（地圖、搜尋、詳情）
2. **警戒模式（80%）**：停用次要功能
3. **限制模式（90%）**：僅提供必要欄位
4. **安全模式（95% 以上）**：僅使用本地資料，詳情頁引導至 Google Maps

## MVP 範圍

1. 基本地圖 + 列表瀏覽
2. 關鍵字搜尋與地理範圍搜尋
3. 顯示本地資料（名稱、地址、電話、狀態）
4. 基礎降級保護機制
5. Google Maps 導航連結

## 成功指標

1. 使用者平均查找醫院時間小於 30 秒
2. 地圖查詢功能正常運作
3. API 使用量控制在免費範圍內
4. 響應式設計支援各種裝置

## 實作里程碑

**第一階段（MVP - 2-3 週）**：
- 導入 JSON 醫院資料至 MongoDB
- 實作地圖/列表檢視
- 關鍵字搜尋功能
- 保險絲策略 v1

**第二階段（+1 個月）**：
- 使用者提報機制
- 醫院詳情頁擴充
- 後台資料更新流程

**第三階段（未來）**：
- Google Places 評分整合
- LINE Notify 整合
- 效能優化

## 技術決策

1. **不使用 Google Maps API**：避免成本風險
2. **採用 Leaflet + OSM**：完全免費方案
3. **座標轉換使用免費服務**：Nominatim 或政府開放資料
4. **前端快取策略**：減少 API 呼叫次數
5. **嚴格遵循 Clean Architecture**：確保可維護性